const path = require('path');
const relativePath = require('cached-path-relative');
const baseDir = path.resolve(__dirname, '../../');

// filter whether we should transform the file or not
module.exports = function filterFile (file, cwd) {
  // transform modules within this module
  if (file.startsWith(baseDir)) {
    cwd = baseDir;
  }
  // otherwise, only transform files outside of node_modules
  const dir = path.dirname(file);
  const relative = relativePath(cwd, dir);
  return !relative.startsWith(`node_modules${path.sep}`);
};
