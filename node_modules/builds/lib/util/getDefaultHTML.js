const path = require('path');
const replace = require('replace-string');

module.exports = function (opts) {
  const name = path.basename(opts.cwd);
  let link = '';
  if (opts.css) {
    link = `\n  <link href="${getURL(opts.css)}" rel="stylesheet">`;
  } else {
    link = `\n  <style>
  body {
    /* A default system font stack and margin. */
    font-family: -apple-system, BlinkMacSystemFont, Helvetica, sans-serif;
    margin: 40px;
  }
  </style>`;
  }
  let script = '';
  if (opts.entries.length > 0 && opts.js) {
    script = `\n  <script src="${getURL(opts.js)}" async></script>`;
  } else {
    script = `\n  <div>Hello, world!</div>`;
  }
  return `<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${name}</title>${link}
</head>
<body>${script}
</body>
</html>
`;
};

function getURL (file) {
  const outPath = replace(file, path.sep, '/');
  return encodeURI(outPath);
}
