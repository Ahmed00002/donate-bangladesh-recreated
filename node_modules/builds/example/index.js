// Import shaders
import fragment from './frag.glsl';
import vertex from './vert.glsl';

// Import styles
import './style.css';

// Import geometry & utilities
import createRegl from 'regl';
import createPrimitive from 'primitive-icosphere';
import createCamera from 'perspective-camera';

// Create WebGL scene
const regl = createRegl(document.body);
const sphere = createPrimitive(1, { subdivisions: 5 });

const camera = createCamera({
  fov: 45 * Math.PI / 180
});

// set up our camera
camera.translate([ 0, 0, 6 ]);
camera.lookAt([ 0, 0, 0 ]);
camera.update();

let draw = regl({
  // Or could use regl.prop() and pass this in
  frag: () => fragment.code,
  vert: () => vertex.code,
  uniforms: {
    time: regl.prop('time'),
    projectionMatrix: regl.prop('projectionMatrix'),
    modelViewMatrix: regl.prop('modelViewMatrix'),
    color: [ 1, 0.5, 0 ]
  },
  attributes: {
    position: regl.buffer(sphere.positions),
    normal: regl.buffer(sphere.normals)
  },
  elements: regl.elements(sphere.cells)
});

regl.frame(context => {
  regl.clear({
    color: [ 0, 0, 0, 1 ],
    depth: 1,
    stencil: 0
  });

  camera.viewport = [ 0, 0, context.viewportWidth, context.viewportHeight ];
  camera.update();

  draw({
    projectionMatrix: camera.projection,
    modelViewMatrix: camera.view,
    time: regl.now()
  });
});
